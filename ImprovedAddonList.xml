<Ui xmlns="http://www.blizzard.com/wow/ui/"   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"   xsi:schemaLocation="http://www.blizzard.com/wow/ui/">

    <Frame name="ImprovedAddonListDropDown" inherits="UIDropDownMenuTemplate" parent="AddonList">
        <Anchors>
            <Anchor point="TOPLEFT" x="0" y="-30"/>
        </Anchors>
        <Scripts>
            <OnLoad>
                AddonCharacterDropDown:Hide()
                UIDropDownMenu_JustifyText(self,"LEFT")
                UIDropDownMenu_SetAnchor(self, 14, 22)
                UIDropDownMenu_SetWidth(self, 140)
            </OnLoad>
        </Scripts>
    </Frame>

    <CheckButton name="ImprovedAddonListCheckButtonTemplate" virtual="true">
		<Size>
			<AbsDimension x="26" y="26"/>
		</Size>
		<HitRectInsets>
			<AbsInset left="0" right="-100" top="0" bottom="0"/>
		</HitRectInsets>
        <Layers>
			<Layer level="ARTWORK">
				<FontString parentKey="Text" inherits="GameFontHighlight">
					<Anchors>
						<Anchor point="LEFT" relativePoint="RIGHT">
							<Offset>
								<AbsDimension x="0" y="0"/>
							</Offset>
						</Anchor>
					</Anchors>
				</FontString>
			</Layer>
		</Layers>
		<Scripts>
			<OnClick>
				if (self:GetChecked()) then
					PlaySound(SOUNDKIT.IG_MAINMENU_OPTION_CHECKBOX_ON);
				else
					PlaySound(SOUNDKIT.IG_MAINMENU_OPTION_CHECKBOX_OFF);
				end
			</OnClick>
			<OnEnter>
				if (self.tooltipText) then
					GameTooltip:SetOwner(self, "ANCHOR_RIGHT");
					GameTooltip_SetTitle(GameTooltip, self.tooltipText);
					GameTooltip:Show();
				end
			</OnEnter>
			<OnLeave>
				if(self.tooltipText ~= nil) then
					GameTooltip:Hide();
				end
			</OnLeave>
		</Scripts>
		<NormalTexture file="Interface\Buttons\UI-CheckBox-Up"/>
		<PushedTexture file="Interface\Buttons\UI-CheckBox-Down"/>
	 	<HighlightTexture file="Interface\Buttons\UI-CheckBox-Highlight" alphaMode="ADD"/>
		<CheckedTexture file="Interface\Buttons\UI-CheckBox-Check"/>
		<DisabledCheckedTexture file="Interface\Buttons\UI-CheckBox-Check-Disabled"/>
	</CheckButton>

    
    <Frame name="ImprovedAddonListConditionDropDownTemplate" inherits="UIDropDownMenuTemplate" mixin="ImprovedAddonListConditionDropDownMixin" virtual="true">
        <Layers>
            <Layer level="ARTWORK">
                <FontString parentKey="Label" inherits="GameFontNormalSmall">
                    <Anchors>
                        <Anchor point="BOTTOMLEFT" relativePoint="TOPLEFT" x="20" y="0"/>
                    </Anchors>
                </FontString>
            </Layer>
        </Layers>
        <Scripts>
            <OnLoad>
                UIDropDownMenu_JustifyText(self,"LEFT")
                UIDropDownMenu_SetAnchor(self, 14, 22)
                UIDropDownMenu_SetWidth(self, 200)
                UIDropDownMenu_Initialize(self, self.OnInitialize)
            </OnLoad>
        </Scripts>
    </Frame>

    <CheckButton name="ImprovedAddonListConditionCheckButtonTemplate" inherits="ImprovedAddonListCheckButtonTemplate" mixin="ImprovedAddonListConditionCheckButtonMixin" virtual="true">
        <Scripts>
            <OnClick>
                self:OnClick()
            </OnClick>
        </Scripts>
    </CheckButton>

    <Frame name="ImprovedAddonListConditionDetailFrameTemplate" inherits="BackdropTemplate" mixin="ImprovedAddonListConditionDetailFrameMixin" virtual="true">
        <Scripts>
            <OnLoad>
                self:SetBackdrop(BACKDROP_TOOLTIP_0_16)
                self:SetBackdropBorderColor(.6, .6, .6, .6)
            </OnLoad>
        </Scripts>
    </Frame>

    <Frame name="ImprovedAddonListConditionItemTemplate" mixin="ImprovedAddonListConditionItemMixin" virtual="true">
        <Size x="515"/>
        <Layers>
            <Layer level="ARTWORK">
                <Texture>
                    <Anchors>
                        <Anchor point="BOTTOMRIGHT" x="-5"/> 
                        <Anchor point="BOTTOMLEFT" x="5"/> 
                    </Anchors>
                    <Size y="1"/>
                    <Color r="1" g="1" b="1" a="0.2" />
                </Texture>
            </Layer>
        </Layers>
        <Frames>
            <CheckButton parentKey="CheckButton" inherits="ImprovedAddonListConditionCheckButtonTemplate">
                <Anchors>
                    <Anchor point="TOPLEFT" x="8" y="-20"/>
                </Anchors>
            </CheckButton>
            <Frame parentKey="DropDown" inherits="ImprovedAddonListConditionDropDownTemplate">  
                <Anchors>
                    <Anchor point="LEFT" x="245"/>
                    <Anchor point="TOP" y="-25"/>
                </Anchors>
            </Frame>
            <Frame parentKey="DetailFrame" inherits="ImprovedAddonListConditionDetailFrameTemplate">
                <Anchors>
                    <Anchor point="TOPLEFT" x="5" y="-60"/>
                    <Anchor point="RIGHT" x="-5"/>
                </Anchors>
            </Frame>
        </Frames>
    </Frame>

    <Button name="ImprovedAddonListButtonTemplate" virtual="true">
        <Size x="14" y="14"/>
        <Scripts>
			<OnEnter>
				if(self.tooltipText ~= nil) then
					GameTooltip:SetOwner(self, "ANCHOR_RIGHT");
					GameTooltip_SetTitle(GameTooltip, self.tooltipText);
					GameTooltip:Show();
				end
			</OnEnter>
			<OnLeave>
				if(self.tooltipText ~= nil) then
					GameTooltip:Hide();
				end
			</OnLeave>
        </Scripts>
    </Button>

    <Button name="ImprovedAddonListRemarkButtonTemplate" inherits="ImprovedAddonListButtonTemplate" virtual="true">
        <NormalTexture file="Interface\AddOns\ImprovedAddonList\Media\remark"/>
        <PushedTexture file="Interface\AddOns\ImprovedAddonList\Media\remark_push"/>
        <HighlightTexture file="Interface\AddOns\ImprovedAddonList\Media\remark_highlight"/>
    </Button>

    <!-- 保存按钮 -->
    <Button name="ImprovedAddonListSaveButton" parent="AddonList" inherits="ImprovedAddonListButtonTemplate" registerForClicks="LeftButtonUp, RightButtonUp">
        <Anchors>
            <Anchor point="LEFT" relativePoint="RIGHT" relativeTo="ImprovedAddonListDropDown" x="0" y="2"/>
        </Anchors>
        <NormalTexture file="Interface\AddOns\ImprovedAddonList\Media\save"/>
        <PushedTexture file="Interface\AddOns\ImprovedAddonList\Media\save_push"/>
        <HighlightTexture file="Interface\AddOns\ImprovedAddonList\Media\save_highlight"/>
    </Button>

    <!-- 另存为按钮 -->
    <Button name="ImprovedAddonListSaveAsButton" parent="AddonList" inherits="ImprovedAddonListButtonTemplate">
        <Anchors>
            <Anchor point="LEFT" relativePoint="RIGHT" relativeTo="ImprovedAddonListSaveButton" x="8" y="0"/>
        </Anchors>
        <NormalTexture file="Interface\AddOns\ImprovedAddonList\Media\saveas"/>
        <PushedTexture file="Interface\AddOns\ImprovedAddonList\Media\saveas_push"/>
        <HighlightTexture file="Interface\AddOns\ImprovedAddonList\Media\saveas_highlight"/>
    </Button>

    <!-- 删除按钮 -->
    <Button name="ImprovedAddonListDeleteButton" parent="AddonList" inherits="ImprovedAddonListButtonTemplate">
        <Anchors>
            <Anchor point="LEFT" relativePoint="RIGHT" relativeTo="ImprovedAddonListSaveAsButton" x="8" y="0"/>
        </Anchors>
        <NormalTexture file="Interface\AddOns\ImprovedAddonList\Media\delete"/>
        <PushedTexture file="Interface\AddOns\ImprovedAddonList\Media\delete_push"/>
        <HighlightTexture file="Interface\AddOns\ImprovedAddonList\Media\delete_highlight"/>
    </Button>

    <!-- 备注按钮 -->
    <Button name="ImprovedAddonListRemarkButton" parent="AddonList" inherits="ImprovedAddonListRemarkButtonTemplate">
        <Anchors>
            <Anchor point="LEFT" relativePoint="RIGHT" relativeTo="ImprovedAddonListDeleteButton" x="8" y="0"/>
        </Anchors>
    </Button>

    <!-- 提示按钮 -->
    <Button name="ImprovedAddonListTipsButton" parent="AddonList" inherits="ImprovedAddonListButtonTemplate" hidden="true">
        <Anchors>
            <Anchor point="LEFT" relativePoint="RIGHT" relativeTo="ImprovedAddonListRemarkButton" x="8" y="0"/>
        </Anchors>
        <NormalTexture file="Interface\AddOns\ImprovedAddonList\Media\tips"/>
    </Button>

    <!-- 输入弹窗 -->
    <Frame name="ImprovedAddonListInputDialog" inherits="ButtonFrameTemplate" parent="AddonList" hidden="true" frameStrata="DIALOG" enableMouse="true">
        <Size x="560" y="480"/>
        <Anchors>
            <Anchor point="TOP" x="0" y="-65"/>
        </Anchors>
        <Layers>
            <Layer level="ARTWORK">
				<FontString parentKey="EditBoxLabel" inherits="GameFontNormal">
					<Anchors>
						<Anchor point="TOPLEFT" x="10" y="-30"/>
					</Anchors>
				</FontString>
                <FontString name="$parentConditionLabel" parentKey="ConditionLabel" inherits="GameFontNormal">
                    <Anchors>
                        <Anchor point="TOPLEFT" x="10" y="-105"/>>
                    </Anchors>
                </FontString>
                <FontString name="$parentConditionTips" parentKey="ConditionTips" inherits="SystemFont_Small" justifyH="RIGHT">
                    <Anchors>
                        <Anchor point="TOPRIGHT" x="-10" y="-100"/>>
                    </Anchors>
                </FontString>
            </Layer>
        </Layers>
        <Frames>
            <!-- 输入框 -->
            <EditBox parentKey="EditBox" multiLine="true" autoFocus="false" letters="45">
                <Anchors>
                    <Anchor point="TOPLEFT" relativePoint="TOPLEFT" relativeTo="$parentInset" x="6" y="-6"/>
                    <Anchor point="BOTTOMRIGHT" relativePoint="BOTTOMRIGHT" relativeTo="$parentInset" x="-6" y="6" />
                </Anchors>
		        <FontString inherits="GameFontHighlightLarge"/>
                <Scripts>
                    <OnEscapePressed>
                        self:ClearFocus()
                    </OnEscapePressed>
                </Scripts>
            </EditBox>
            <!-- 确定按钮 -->
            <Button parentKey="OkayButton" inherits="ImprovedAddonListOkayButtonTemplate" text="OKAY">
                <Size x="80" y="22"/>
                <Anchors>
                    <Anchor point="BOTTOMRIGHT" x="-4" y="4"/>
                </Anchors>
                <Scripts>
                    <OnLoad>
                        self:SetFrameLevel(self:GetParent().EditBox:GetFrameLevel()+1)
                    </OnLoad>
                </Scripts>
            </Button>
            <!-- 保存到全局 -->
            <CheckButton parentKey="SaveToGlobal" inherits="ImprovedAddonListCheckButtonTemplate">
                <Anchors>
                    <Anchor point="BOTTOMLEFT" x="4" y="2"/>
                </Anchors>
                <Scripts>
                    <OnLoad>
                        self.Text:SetFontObject(GameFontNormal)
                    </OnLoad>
                </Scripts>
            </CheckButton>
            <!-- 弹窗提示 -->
            <CheckButton parentKey="ShowStaticPop" inherits="ImprovedAddonListCheckButtonTemplate">
                <Anchors>
                    <Anchor point="BOTTOMLEFT" x="150" y="2"/>
                </Anchors>
                <Scripts>
                    <OnLoad>
                        self.Text:SetFontObject(GameFontNormal)
                    </OnLoad>
                </Scripts>
            </CheckButton>

            <!-- 载入条件容器 -->
            <ScrollFrame name="$parentConditionContainer" parentKey="ConditionContainer" inherits="UIPanelScrollFrameTemplate, BackdropTemplate">
                <Anchors>
                    <Anchor point="LEFT" x="6"/>
                    <Anchor point="TOP" relativePoint="BOTTOM" relativeTo="$parentConditionLabel" y="-4"/>
                    <Anchor point="BOTTOMRIGHT" x="-6" y="28"/>>
                </Anchors>
                <Scripts>
                    <OnLoad>
                        self.ScrollBar:ClearAllPoints()
                        self.ScrollBar:SetPoint("TOPRIGHT",  -6, -24)
                        self.ScrollBar:SetPoint("BOTTOMRIGHT", -6, 24)
                        self:SetBackdrop(BACKDROP_TOOLTIP_0_16)
                        self:SetBackdropBorderColor(.6, .6, .6, .6)
                    </OnLoad>
                </Scripts>
            </ScrollFrame>
        </Frames>
        
        <Scripts>
            <OnLoad>
                self.Inset:ClearAllPoints()
                self.Inset:SetHeight(45)
                self.Inset:SetPoint("TOPLEFT", 4, -50)
                self.Inset:SetPoint("TOPRIGHT", -4, -50)
                ButtonFrameTemplate_HidePortrait(self)
            </OnLoad>
            <OnShow>
                self.EditBox:SetFocus()
            </OnShow>
            <OnKeyDown>
                if key == "ESCAPE" then
                    self:Hide()
                end
                self:SetPropagateKeyboardInput(key ~= "ESCAPE")
            </OnKeyDown>
        </Scripts>
    </Frame>

    <!-- 条件Container Content -->
    <Frame name="ImprovedAddonListConditionContent" parent="ImprovedAddonListInputDialogConditionContainer">
        <Size x="1" y="1"/>
        <Anchors>
            <Anchor point="TOPLEFT"/>
        </Anchors>
        <Frames>
            <!-- 角色名 -->
            <Frame name="$parentPlayerNameItem" parentKey="PlayerNameItem" inherits="ImprovedAddonListConditionItemTemplate">
                <Anchors>
                    <Anchor point="TOPLEFT" x="4" y="-10"/>
                </Anchors>
            </Frame>
            <!-- 副本类型 -->
            <Frame name="$parentInstanceTypeItem" parentKey="InstanceTypeItem" inherits="ImprovedAddonListConditionItemTemplate">
                <Anchors>
                    <Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT" relativeTo="$parentPlayerNameItem" y="-10"/>
                </Anchors>
            </Frame>
            <!-- 职业和专精 -->
            <Frame name="$parentClassAndSpecItem" parentKey="ClassAndSpecItem" inherits="ImprovedAddonListConditionItemTemplate">
                <Anchors>
                    <Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT" relativeTo="$parentInstanceTypeItem" y="-10"/>
                </Anchors>
            </Frame>
            <!-- 战争模式 -->
            <Frame name="$parentWarModeItem" parentKey="WarModeItem" inherits="ImprovedAddonListConditionItemTemplate">
                <Anchors>
                    <Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT" relativeTo="$parentClassAndSpecItem" y="-10"/>
                </Anchors>
            </Frame>
            <!-- 阵营 -->
            <Frame name="$parentFactionItem" parentKey="FactionItem" inherits="ImprovedAddonListConditionItemTemplate">
                <Anchors>
                    <Anchor point="TOPLEFT" relativePoint="BOTTOMLEFT" relativeTo="$parentWarModeItem" y="-10"/>
                </Anchors>
            </Frame>
        </Frames>
        <Scripts>
            <OnLoad>
                ImprovedAddonListInputDialogConditionContainer:SetScrollChild(self)
            </OnLoad>
        </Scripts>
    </Frame>

    <!-- 提示窗选项模板 -->
    <Frame name="ImprovedAddonListSwitchConfigurationPromptItemTemplate" virtual="true">
        <Size x="130" y="55"/>
        <Layers>
		    <Layer level="BACKGROUND">
		    	<Texture parentKey="Background" atlas="StoryHeader-BG" useAtlasSize="true">
		    		<Anchors>
		    			<Anchor point="TOPLEFT"/>
                        <Anchor point="BOTTOMRIGHT"/>
		    		</Anchors>
		    	</Texture>
		    </Layer>
            <Layer level="ARTWORK">
                <FontString parentKey="Text" inherits="GameFontHighlight">
                    <Anchors>
                        <Anchor point="CENTER" y="5"/>
                    </Anchors>
                </FontString>
            </Layer>
		    <Layer level="HIGHLIGHT">
		    	<Texture parentKey="HighlightTexture" file="Interface\QuestFrame\UI-QuestLogTitleHighlight" alphaMode="ADD" hidden="true">
		    		<Anchors>
                        <Anchor point="TOP"/>
                        <Anchor point="BOTTOM" y="10"/>
		    		</Anchors>
		    		<Color color="HIGHLIGHT_LIGHT_BLUE"/>
		    	</Texture>
		    </Layer>
        </Layers>
        <Scripts>
            <OnEnter>
				if(self.tooltipText ~= nil) then
					GameTooltip:SetOwner(self, "ANCHOR_RIGHT");
					GameTooltip_SetTitle(GameTooltip, self.tooltipText);
					GameTooltip:Show();
				end
                local duration = ImprovedAddonListSwitchConfigurationPromptDialog.Anim.Alpha:GetDuration()
                ImprovedAddonListSwitchConfigurationPromptDialog.Anim.alphaTimeLeft = math.max(3, math.ceil(duration*(1-ImprovedAddonListSwitchConfigurationPromptDialog.Anim.Alpha:GetProgress())))
                ImprovedAddonListSwitchConfigurationPromptDialog.Anim:Stop()
                ImprovedAddonListSwitchConfigurationPromptDialog.Anim.Alpha:SetDuration(ImprovedAddonListSwitchConfigurationPromptDialog.Anim.alphaTimeLeft)
                self.HighlightTexture:Show()
            </OnEnter>
            <OnLeave>
				if(self.tooltipText ~= nil) then
					GameTooltip:Hide();
				end
                ImprovedAddonListSwitchConfigurationPromptDialog.Anim:Play()
                self.HighlightTexture:Hide()
            </OnLeave>
        </Scripts>
    </Frame>

    <!-- 提示窗 -->
    <Frame name="ImprovedAddonListSwitchConfigurationPromptDialog" inherits="ImprovedAddonListSwitchConfigurationPromptDialogTemplate">
        <Frames>
            <ScrollFrame parentKey="List" inherits="UIPanelScrollFrameTemplate, BackdropTemplate">
                <Anchors>
                    <Anchor point="TOPLEFT" x="4" y = "-22"/>
                    <Anchor point="BOTTOMRIGHT" x="-4" y="2"/>
                </Anchors>
                <ScrollChild>
                    <Frame parentKey="Content">
                        <Size x="1" y="1"/>
                        <Anchors>
                            <Anchor point="TOPLEFT"/>
                        </Anchors>
                    </Frame>
                </ScrollChild>
                <Scripts>
                    <OnLoad>
                        self.ScrollBar:ClearAllPoints()
                        self.ScrollBar:SetPoint("TOPRIGHT",  -6, -24)
                        self.ScrollBar:SetPoint("BOTTOMRIGHT", -6, 24)
                    </OnLoad>
                </Scripts>
            </ScrollFrame>
        </Frames>
    </Frame>

    <!-- 输入备注 -->
    <Frame name="ImprovedAddonListInputRemarkDialog" inherits="BasicFrameTemplateWithInset" parent="AddonList" hidden="true" frameStrata="DIALOG" enableMouse="true">
        <Size x="320" y="100"/>
        <Layers>
            <Layer level="ARTWORK">
				<FontString parentKey="Label" inherits="GameFontNormal">
					<Anchors>
						<Anchor point="TOPLEFT" x="10" y="-30"/>
					</Anchors>
				</FontString>
            </Layer>
        </Layers>
        <Frames>
            <EditBox parentKey="EditBox" multiLine="true" autoFocus="false" letters="30">
                <Anchors>
                    <Anchor point="TOPLEFT" x="8" y="-50"/>
                    <Anchor point="BOTTOMRIGHT"  x="-8" y="8" />
                </Anchors>
		        <FontString inherits="GameFontHighlightLarge"/>
                <Scripts>
                    <OnEscapePressed>
                        self:ClearFocus()
                    </OnEscapePressed>
                </Scripts>
            </EditBox>
        </Frames>
        <Scripts>
            <OnShow>
                self.EditBox:SetFocus()
            </OnShow>
            <OnHide>
                self.addonName = nil
            </OnHide>
            <OnKeyDown>
                if key == "ESCAPE" then
                    self:Hide()
                end
                self:SetPropagateKeyboardInput(key ~= "ESCAPE")
            </OnKeyDown>
        </Scripts>
    </Frame>
</Ui>